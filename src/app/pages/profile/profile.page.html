<ion-header>
  <ion-toolbar>
    <ion-title>Profile</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-grid no-padding>
    <ion-row justify-content-center>
      <ion-col size-md="6" size-lg="5" size-xs="12">

        <ng-template [ngIf]="studentRole" [ngIfElse]="userIsStaff">
          <ion-card no-margin no-padding text-center>
            <!-- STUDENT IMAGE AND ITS LOADING -->
            <ng-template [ngIf]="photo$ | async" [ngIfElse]="loadingPicture">
              <div class="img-wrapper" margin-top margin-bottom>
                <ion-img class="profile-photo" [src]="
                                        'data:image/jpg;base64,' +
                                        ((photo$ | async) || {}).base64_photo
                                        " (ionError)="$event.target.src = 'assets/img/no_img.png'">
                </ion-img>
              </div>
            </ng-template>
            <ng-template let-profile [ngIf]="profile$ | async" [ngIfElse]="loadingProfile">
              <ion-card-header>
                <ion-card-title>
                  <h3 class="responsive-h1">{{ profile.NAME }}</h3>
                </ion-card-title>
                <ion-card-subtitle>
                  <h5 class="responsive-h2">{{ profile.STUDENT_NUMBER }} | {{ profile.INTAKE }}</h5>
                </ion-card-subtitle>
              </ion-card-header>
              <ion-card-content>
                <div class="info-div">
                  <h4>Programme</h4>
                  <p>{{ profile.PROGRAMME }}</p>
                </div>
                <div class="col-12 text-center info-div">
                  <ng-template [ngIf]="profile.MENTOR_SAMACCOUNTNAME" [ngIfElse]="mentorLost">
                    <h4>Mentor Name</h4>
                    <p (click)="openStaffDirectoryInfo(profile.MENTOR_SAMACCOUNTNAME)"
                      class="cursor-pointer colored-text">{{ profile.MENTOR_NAME }}</p>
                  </ng-template>
                  <ng-template #mentorLost>
                    <h4>Mentor Name</h4>
                    <p>{{ profile.MENTOR_NAME }}</p>
                  </ng-template>
                </div>
                <div class="col-12 text-center info-div">
                  <ng-template [ngIf]="profile.PL_SAMACCOUNTNAME" [ngIfElse]="plLost">
                    <h4>Programme Leader</h4>
                    <p (click)="openStaffDirectoryInfo(profile.PL_SAMACCOUNTNAME)" class="colored-text cursor-pointer">
                      {{ profile.PL_NAME }}</p>
                  </ng-template>
                  <ng-template #plLost>
                    <h4>Programme Leader</h4>
                    <p>{{ profile.PL_NAME }}</p>
                  </ng-template>
                </div>
                <div class="col-12 text-center info-div" *ngIf='!local'>
                  <ng-template let-visa [ngIf]='visa$ | async'>
                    <ng-template [ngIf]='visa[0].VISA_EXPIRY_DATE' [ngIfElse]='noVisa'>
                      <h4>Student Pass Expiry Date</h4>
                      <p>
                        {{ visa[0].VISA_EXPIRY_DATE | date: 'dd-LLL-yyyy' }}
                      </p>
                    </ng-template>
                    <ng-template #noVisa>
                      <h4>Student Pass Expiry Date</h4>
                      <ion-text color="danger">
                        <p>
                          Error while trying to get pass expiry date
                        </p>
                      </ion-text>
                    </ng-template>
                  </ng-template>
                </div>

                <div class="col-12 text-center info-div">
                  <h4>Country</h4>
                  <p>{{ profile.COUNTRY }}</p>
                </div>

              </ion-card-content>

            </ng-template>
            <div id="map"></div>
          </ion-card>
        </ng-template>


        <ng-template #userIsStaff>
          <ion-card no-margin no-padding text-center>
            <!-- STAFF IMAGE AND ITS LOADING -->
            <ng-template [ngIf]="staffProfile$ | async" [ngIfElse]="loadingPicture">
              <ion-img margin-top class="profile-photo" [src]="(staffProfile$ | async)[0]?.PHOTO"
                (ionError)="$event.target.src = 'assets/img/no_img.png'"> </ion-img>
            </ng-template>
            <ng-template let-staffProfile [ngIf]="staffProfile$ | async" [ngIfElse]="loadingProfile">
              <ion-card-header>
                <ion-card-title>
                  <h3 class="responsive-h1">
                    {{ staffProfile[0].FULLNAME }}
                  </h3>
                </ion-card-title>
                <ion-card-subtitle>
                  <h5 class="responsive-h2">{{ staffProfile[0].TITLE }}</h5>
                </ion-card-subtitle>
              </ion-card-header>
              <ion-card-content>
                <div class="col-12 text-center info-div">
                  <h4>ID</h4>
                  <p>{{ staffProfile[0].ID }}</p>
                </div>
                <div class="col-12 text-center info-div">
                  <h4>Current Job Type</h4>
                  <p>{{ staffProfile[0].CURRENT_JOB_TYPE }}</p>
                </div>

                <div class="col-12 text-center info-div">
                  <h4>Department</h4>
                  <p>{{ staffProfile[0].DEPARTMENT }}</p>
                </div>

                <ng-template [ngIf]="staffProfile[0].DEPARTMENT1">
                  <div class="col-12 text-center info-div">
                    <h4>Department 1</h4>
                    <p>{{ staffProfile[0].DEPARTMENT1 }}</p>
                  </div>
                </ng-template>

                <ng-template [ngIf]="staffProfile[0].DEPARTMENT2">
                  <div class="col-12 text-center info-div">
                    <h4>Department 2</h4>
                    <p>{{ staffProfile[0].DEPARTMENT2 }}</p>
                  </div>
                </ng-template>

                <div class="col-12 text-center info-div">
                  <h4>Nationality</h4>
                  <p>{{ staffProfile[0].NATIONALITY }}</p>
                </div>

              </ion-card-content>

            </ng-template>
            <div id="map"></div>

          </ion-card>
        </ng-template>
        <ng-template #loadingPicture>
          loading the staff image...
        </ng-template>
        <ng-template #loadingProfile>
          Loading the profile
        </ng-template>

      </ion-col>
    </ion-row>
  </ion-grid>

</ion-content>