<ion-header no-border>
  <ion-navbar>
    <ion-title>View Progress Report</ion-title>
    <ion-buttons end>
      <button ion-button icon-only clear class="notification-button colored-border" (click)="toggleFilterMenu()">
        <ion-icon name="options"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-menu [content]="content" side="right">
  <ion-header>
    <ion-toolbar>
      <ion-buttons end>
        <button ion-button icon-only (click)="toggleFilterMenu()">
          <ion-icon name="close"></ion-icon>
        </button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-item>
      <ion-label>Subject List</ion-label>
      <ion-select [(ngModel)]="subject" (ngModelChange)="onSubjectChanged()">
        <ion-option disabled selected value="">Choose One</ion-option>
        <ion-option *ngFor="let subject of subjects" [value]="subject.SUBJECT_CODE">{{subject.SUBJECT_CODE}}
        </ion-option>
      </ion-select>
    </ion-item>
    <ion-item *ngIf="subject">
      <ion-label>Class Code</ion-label>
      <ion-select [(ngModel)]="classCode" (ngModelChange)="onClassCodeChanged()">
        <ion-option disabled selected value="">Choose One</ion-option>
        <ion-option *ngFor="let class of classes" [value]="class.CLASS_CODE">{{class.CLASS_CODE}}</ion-option>
      </ion-select>
    </ion-item>
  </ion-content>
</ion-menu>


<ion-content #content>
  <ng-template [ngIf]="!subject && !classCode">
    <div class="row mt-5">
      <div class="col-12 px-5">
        <p class="normaltext text-center">
          To view the progress report for a class, please
          <a style="text-decoration: underline" class="colorful-text font-weight-bold"
            (click)="toggleFilterMenu()">select a subject</a>
          first
        </p>
      </div>
    </div>

  </ng-template>
  <ng-template [ngIf]="subject && !classCode">
    <div class="row mt-5">
      <div class="col-12 px-5">
        <p class="normaltext text-center">
          To view the progress report for {{subject}}, please
          <a style="text-decoration: underline" class="colorful-text font-weight-bold"
            (click)="toggleFilterMenu()">select a class code</a>
          also
        </p>
      </div>
    </div>
  </ng-template>
  <ng-template [ngIf]="subject && classCode">
    <ng-template let-classDescription [ngIf]="classDescription$ | async">
      <div class="container p-0">
        <ng-template [ngIf]="studentsBehaviour$ | async"></ng-template>

        <div class="row mt-3">
          <div class="col-6 px-5 py-2">
            <p>
              Class Code:
            </p>
            <p class="font-weight-bold"> {{ classCode }}</p>
            <p>
              Lecturer Name:
            </p>
            <p class="font-weight-bold">
              {{ classDescription[0].LECTURER_NAME || 'N/A' }}
            </p>
          </div>
          <div class="col-6 px-5 py-2">
            <p>
              Start Date:
            </p>
            <p class="font-weight-bold">
              {{ classDescription[0].SDATE || 'N/A' }}
            </p>
            <p>
              End Date:
            </p>
            <p class="font-weight-bold">
              {{ classDescription[0].EDATE || 'N/A' }}
            </p>
          </div>
          <div class="col-12 px-5 py-2" *ngIf="classDescription[0].CLASS_DESCRIPTION">
            <p>
              Class Description:
            </p>
            <p class="font-weight-bold">
              {{ classDescription[0].CLASS_DESCRIPTION }}
            </p>
          </div>
        </div>
      </div>
    </ng-template>
    <ng-template let-studentBehaviors [ngIf]="studentsBehaviour$ | async">
      <div class="row">
        <div class="container p-0">
          <div class="col-12 p-0">
            <ion-list>
              <ion-item no-lines class="my-3 px-5 d-none d-md-block">
                <div class="row">
                  <div class="col-12 col-md-3">Student Name</div>
                  <div class="col-12 col-md-3">Student ID</div>
                  <div class="col-12 col-md-3">Average Score</div>
                  <div class="col-12 col-md-3">Score Description</div>
                </div>
              </ion-item>
              <ion-item no-lines class="my-3 px-5" *ngFor="let studentBehavior of studentBehaviors">
                <div class="row">
                  <div class="col-12 col-md-3 item">
                    <small class="d-md-none font-weight-bold" stacked>Student Name:</small>
                    <h3 class="student-name">
                      {{ studentBehavior.STUDENT_NAME }}
                    </h3>
                  </div>
                  <div class="col-12 col-md-3 item">
                    <small class="d-md-none font-weight-bold mt-3">Student ID:</small>
                    <h4>{{ studentBehavior.STUDENT_NUMBER }}</h4>
                  </div>
                  <div class="col-12 col-md-3 item">
                    <small class="d-md-none font-weight-bold mt-3">Average Score:</small>
                    <h4>
                      {{ +studentBehavior.AVERAGE_BEH > 0 ? studentBehavior.AVERAGE_BEH : 'N/A' }}
                    </h4>
                  </div>
                  <div class="col-12 col-md-3 item">
                    <small class="d-md-none font-weight-bold mt-3">Score Description:</small>
                    <h4>
                      {{ +studentBehavior.AVERAGE_BEH > 0 ? getScoreLegendDescription(+studentBehavior.AVERAGE_BEH) : 'N/A' }}
                    </h4>
                  </div>
                  <div class="col-12 col-md-3 item" *ngIf="studentBehavior.REMARK">
                    <small class="d-md-none font-weight-bold mt-3">Remarks:</small>
                    <h4>{{ studentBehavior.REMARK }}</h4>
                  </div>
                </div>
              </ion-item>
            </ion-list>
          </div>
        </div>
      </div>
    </ng-template>

  </ng-template>
</ion-content>