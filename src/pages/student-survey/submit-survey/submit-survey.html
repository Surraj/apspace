<ion-header no-border>
  <ion-navbar>
    <ion-title>Student Survey</ion-title>
    <ion-buttons end>
      <button ion-button icon-only clear class="notification-button colored-border" (click)="toggleFilterMenu()"
        [disabled]="intakesAreLoading">
        <ion-icon name="options"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-menu [content]="content" side="right">
  <ion-header>
    <ion-toolbar>
      <ion-buttons end>
        <button ion-button icon-only (click)="toggleFilterMenu()">
          <ion-icon name="close"></ion-icon>
        </button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>
  <ion-content>

    <ion-item no-lines>
      <ion-label>Intake</ion-label>
      <ion-select [(ngModel)]="intakeCode" (ngModelChange)="onIntakeCodeChanged()">
        <ion-option disabled selected value="">Choose One</ion-option>
        <ion-option *ngFor="let intake of intakes" [value]="intake.COURSE_CODE_ALIAS">{{intake.COURSE_CODE_ALIAS}}
        </ion-option>
      </ion-select>
    </ion-item>

    <ion-item no-lines *ngIf="modulesAreLoading">
      <ion-label>Getting the list of modules...</ion-label>
    </ion-item>
    <ng-template [ngIf]="intakeCode && !modulesAreLoading">
      <ng-template [ngIf]="modules.length > 0" [ngIfElse]="noModules">
        <ion-item no-lines>
          <ion-label>Module</ion-label>
          <ion-select [(ngModel)]="moduleCode" (ngModelChange)="onModuleCodeChanged()">
            <ion-option disabled selected value="">Choose One</ion-option>
            <ion-option *ngFor="let module of modules" [value]="module.SUBJECT_CODE">{{module.SUBJECT_DESCRIPTION}}
            </ion-option>
          </ion-select>
        </ion-item>
      </ng-template>
      <ng-template #noModules>
        <ion-item no-lines>
          <ion-label class="p-3 text-center userMessage">
            You have done the survey for all modules in this intake
          </ion-label>
        </ion-item>
      </ng-template>
    </ng-template>

    <ng-template [ngIf]="intakeCode && moduleCode">
      <ion-item no-lines>
        <ion-label>Type</ion-label>
        <ion-select [(ngModel)]="surveyType" (ngModelChange)="onSurveyTypeChanged()">
          <ion-option disabled selected value="">Choose One</ion-option>
          <ion-option *ngFor="let surveyType of surveyTypes" [value]="surveyType">{{surveyType}}
          </ion-option>
        </ion-select>
      </ion-item>
    </ng-template>
  </ion-content>
</ion-menu>


<ion-content #content>
  <div *ngIf="intakesAreLoading" class="row mt-5">
    <div class="col-12 px-5">
      <loading-spinner class="mt-5"></loading-spinner>
      <p class="mt-5 normaltext text-center">
        Getting the list of intakes ready...
      </p>
    </div>
  </div>
  <ng-template [ngIf]="!intakesAreLoading && !intakeCode">
    <div class="row mt-5">
      <div class="col-12 px-5">
        <p class="normaltext text-center">
          To submit a student survey, please
          <a style="text-decoration: underline" class="colorful-text font-weight-bold"
            (click)="toggleFilterMenu()">select an intake and module</a>
          first
        </p>
      </div>
    </div>
  </ng-template>

  <ng-template [ngIf]="intakeCode && !moduleCode">
    <div class="row mt-5">
      <div class="col-12 px-5">
        <p class="normaltext text-center">
          To submit the survey for {{intakeCode}}, please
          <a style="text-decoration: underline" class="colorful-text font-weight-bold"
            (click)="toggleFilterMenu()">select a module</a>
          also
        </p>
      </div>
    </div>
  </ng-template>

  <ng-template [ngIf]="intakeCode && moduleCode && !surveyType">
    <div class="row mt-5">
      <div class="col-12 px-5">
        <p class="normaltext text-center">
          To submit the survey for {{intakeCode}} - {{moduleCode}}, please
          <a style="text-decoration: underline" class="colorful-text font-weight-bold"
            (click)="toggleFilterMenu()">select a survey type</a>
          also
        </p>
      </div>
    </div>
  </ng-template>

  <ng-template [ngIf]="intakeCode && moduleCode && surveyType">
    <ng-template let-surveys [ngIf]="survey$ | async" [ngIfElse]="surveysAreLoading">
      <ng-template [ngIf]="surveys.length > 0">
        <div class="survey-wrapper" *ngFor="let survey of surveys">
            <h3 class="p-3 mt-2 survey-type">{{ survey | json}}</h3>
          <div class="row">
            <div class="col-12 survey" *ngFor="let surveySection of survey.sections">
              <h3 class="p-3 mt-2 survey-section-name">{{ surveySection.name}}</h3>
              <p class="p-3 mt-2 survey-type">{{ surveySection.questions | json}}</p>
            </div>
          </div>

        </div>
      </ng-template>
      <ng-template #noSurveys>
        You do not have any surveys to be submitted for {{moduleCode}}
      </ng-template>
    </ng-template>
    <ng-template #surveysAreLoading>
      loading the surveys...
    </ng-template>
  </ng-template>

</ion-content>