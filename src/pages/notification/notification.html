<ion-header no-border>
  <ion-navbar>
    <ion-title>Notifications</ion-title>
  </ion-navbar>
  <ion-toolbar no-border-top>
    <ion-segment [(ngModel)]="notifications" color="light">
      <ion-segment-button value="unread"> Unread messages </ion-segment-button>
      <ion-segment-button value="all"> History </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content no-padding>
  <ng-template [ngIf]='cordova' [ngIfElse]='notCordova'>
    <ion-refresher pullMax="400" pullMin="60" (ionRefresh)="doRefresh($event)">
      <ion-refresher-content pullingIcon="refresh">
      </ion-refresher-content>
    </ion-refresher>
    <ng-container [ngSwitch]="notifications">
      <div *ngSwitchCase="'all'">
        <div class="container">
          <div class="row">
            <div class="col-12" *ngFor="let category of objectKeys(message$ | async)">
              <div class="row">
                <div class="col-12 py-4 px-3 category" [ngStyle]="{
                background:
                  'linear-gradient(to right, ' +
                  testRes.history[category].firstColor +
                  ',' +
                  testRes.history[category].secondColor   +
                  ')'
              }">
                  <h3 class="mb-0">
                    {{category}}
                  </h3>
                </div>
              </div>
              <div class="row p-3 notification" *ngFor="let message of testRes.history[category].items"
                (click)="openBasicModal(message, message.message_id)" [class.unread]="!message.read">
                <div class="col-2 notification-icon m-auto text-center">
                  <ion-icon [name]="message.read ? 'mail-open' : 'mail'" item-left></ion-icon>
                </div>
                <div class="col-10 notification-message">
                  <div class="row">
                    <div class="col-12 title">
                      <h4 class="mb-0">
                        {{message.title}}
                      </h4>
                    </div>
                    <div class="col-12">
                      <small>{{message.message_id * 1000 | date : "EEE, d MMM y"}}</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngSwitchCase="'unread'">
        <div class="container">
          <div class="row">
            <div class="col-12" *ngFor="let category of objectKeys(message$ | async)">
              <div class="row p-3 notification" *ngFor="let message of testRes.history[category].items | unread"
                (click)="openBasicModal(message, message.message_id)" [class.unread]="!message.read">
                <div class="col-2 notification-icon m-auto text-center">
                  <ion-icon [name]="message.read ? 'mail-open' : 'mail'" item-left></ion-icon>
                </div>
                <div class="col-6 notification-message">
                  <div class="row">
                    <div class="col-12 title">
                      <h4 class="mb-0">
                        {{message.title}}
                      </h4>
                    </div>
                    <div class="col-12">
                      <small>{{message.message_id * 1000 | date : "EEE, d MMM y"}}</small>
                    </div>
                  </div>
                </div>
                <div class="col-4 m-auto text-center category-badge">
                  <span class="badge" [ngStyle]="{
                    background:
                      'linear-gradient(to right, ' +
                      testRes.history[category].firstColor +
                      ',' +
                      testRes.history[category].secondColor   +
                      ')'
                  }">
                    {{category}}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="isLoading">
      <ion-item *ngFor="let i of numOfSkeletons">
        <ion-avatar item-start>
          <skeleton-item height="50px" width="50px" rounded></skeleton-item>
        </ion-avatar>
        <skeleton-item height="50px" width="100%"></skeleton-item>
        <skeleton-item height="5px" width="150px"></skeleton-item>
      </ion-item>
    </ng-container>

  </ng-template>
  <ng-template #notCordova>
    <h5 class="p-4 text-center notification-desktop">
      Notification is only available in the mobile application
    </h5>
  </ng-template>
</ion-content>