<ion-header>
  <ion-navbar>
    <ion-title>Bus Tracking</ion-title>
    <ion-buttons end>
      <button ion-button outline small class='notification-button colored-border' (click)="openFilterMenu()">
        <ion-icon name="options"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-menu [content]="content" side="right">
  <ion-header>
    <ion-toolbar>
      <ion-title>Filter Trips</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list>
      <ion-item-divider>
        <ion-label>
          Filter by locations:
        </ion-label>
      </ion-item-divider>
      <ion-item>
        <ion-label>From</ion-label>
        <ion-select [(ngModel)]="fromLocation">
          <ion-option selected value="">Any</ion-option>
          <ion-option *ngFor="let location of locations" [value]="location.location_name">{{location.location_nice_name}}</ion-option>
        </ion-select>
      </ion-item>
      <ion-item>
        <ion-label>To</ion-label>
        <ion-select [(ngModel)]="toLocation">
          <ion-option selected value="">Any</ion-option>
          <ion-option *ngFor="let location of locations" [value]="location.location_name">{{location.location_nice_name}}</ion-option>
        </ion-select>
      </ion-item>
      <ion-item-divider color="secondary">
        <ion-label>
          Filter by days:
        </ion-label>
      </ion-item-divider>
      <ion-item>
        <ion-label>Day</ion-label>
        <ion-select [(ngModel)]="tripDay">
          <ion-option selected value="mon-fri">Monday-Friday</ion-option>
          <ion-option value="fri">Friday</ion-option>
          <ion-option value="sat">Saturday</ion-option>
          <ion-option value="sun">Sunday</ion-option>
        </ion-select>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<ion-content #content>
  <!-- refresher -->
  <ion-refresher pullMax="400" pullMin="60" (ionRefresh)='getTrips($event)'>
    <ion-refresher-content pullingIcon="refresh">
    </ion-refresher-content>
  </ion-refresher>

  <!-- <ng-container *ngIf="trip$ | async | on:selectedDay | during:selectedFrom:selectedTo as trips">
    <div class="miniLocationButtonDiv" *ngIf="selectedFrom !== 'Any'">
      <img id="mapButton" tappable src="assets/img/miniMapF.png" alt="Smiley face" height="42" width="42" (click)="presentMoreInfoModal(trips, trip, 'location')">
    </div>

    <img class="BgImageVertical" src="assets/img/mapWithMarkers.png" alt="Map with markers">
    <img class="BgImageHorizontal" src="assets/img/mapWithMarkersHorizontal.jpg" alt="Map with markers Horizontal">

    <div class="underFadeDiv"></div>
    <div class="chosenLocationDiv" *ngIf="trips | nextTrip as trip; else unAvail">
      <ion-icon class="moreInfoIcon" name="arrow-dropup"></ion-icon>
      <div class="iconAndTimeDIv">
        <button detail-none ion-item class="itemButton" style="background-color: #fefefe !important" (click)="presentMoreInfoModal(trips, trip, 'timings')">
          <ion-icon class="shk" style="float: left !important; color: #a9a9a9" name="bus"></ion-icon>
          <h3 class="busTime">Next bus at {{ trip }}</h3>
        </button>
      </div>
    </div>
    <ng-template #unAvail>
      <div class="chosenLocationDiv">
        <div class="iconAndTimeDIv">
          <button detail-none ion-item disabled>
            <ion-icon style="float: left !important; color: #a9a9a9" name="bus"></ion-icon>
            <h3 class="busTime">Buses unavailable</h3>
          </button>
        </div>
      </div>
    </ng-template>

    <div class="destinationDiv">
      <div class="destinationItemsDiv">
        <ion-item no-padding>
          <ion-select [(ngModel)]="selectedFrom" interface='popover' placeholder='From'>
            <ion-option *ngFor="let trip of objectKeys(tripFrom)" [value]="trip"
              style="z-index: 0 !important">
              {{ tripFrom[trip] }}
            </ion-option>
            <ion-option>Any</ion-option>
          </ion-select>
        </ion-item>
        <ion-item no-padding>
          <ion-select [(ngModel)]="selectedTo" interface='popover' placeholder='To'>
            <ion-option *ngFor="let trip of objectKeys(tripTo)" [value]="trip">
              {{ tripTo[trip] }}
            </ion-option>
            <ion-option>Any</ion-option>
          </ion-select>
        </ion-item>
      </div>

      <button class="swap" ion-button icon-only small item-end (click)="swapTrip()">
        <ion-icon name='swap'></ion-icon>
      </button>
    </div>

  </ng-container> -->

  <ng-template let-trips [ngIf]="trip$ | async" [ngIfElse]="loadingTrips">
    <div class="row mt-3">
      <div class="col-12">
        <div *ngFor="let sourceKey of objectKeys(trips)">
          <div class="px-0 trips-card" *ngFor="let destinationKey of objectKeys(trips[sourceKey])">
            <h2 class=" trips-card-header py-4 px-3 mb-3 sticky-top" [ngStyle]="{'background':'linear-gradient(to right, ' + getLocationColor(sourceKey) + ',' + getLocationColor(destinationKey) + ')'}">
              {{getLocationDisplayName(sourceKey) + ' -> ' + getLocationDisplayName(destinationKey)}}
            </h2>
            <div class="row trips-card-data">
              <p *ngFor="let trip of trips[sourceKey][destinationKey]" class="col-3 text-center trip-time"
                [style.color]="strToTime(trip.trip_time) >= dateNow ? '#fff' : '#c6c2c2'" [style.fontWeight]="strToTime(trip.trip_time) >= dateNow ? 'bold' : 'lighter'">
                {{trip.trip_time}}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
  <ng-template #loadingTrips>
    <ion-card *ngFor="let i of numOfSkeletons">
      <ion-card-content>
        <skeleton-item height="20px" width="80%"></skeleton-item>
        <skeleton-item height="16px" width="40%"></skeleton-item>
      </ion-card-content>
    </ion-card>
  </ng-template>

</ion-content>