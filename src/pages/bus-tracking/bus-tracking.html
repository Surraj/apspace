<ion-header>
  <ion-navbar>
    <ion-title>Bus Tracking</ion-title>
    <ion-buttons end>
      <button ion-button outline small class="notification-button colored-border" (click)="toggleFilterMenu()">
        <ion-icon name="options"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-menu [content]="content" side="right">
  <ion-header>
    <ion-toolbar>
      <ion-title>Filter Trips</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list>
      <ion-item>
        <ion-label>From</ion-label>
        <ion-select [(ngModel)]="fromLocation">
          <ion-option selected value="">Any</ion-option>
          <ion-option *ngFor="let location of locations" [value]="location.location_name">{{
            location.location_nice_name }}</ion-option>
        </ion-select>
      </ion-item>
      <ion-item>
        <ion-label>To</ion-label>
        <ion-select [(ngModel)]="toLocation">
          <ion-option selected value="">Any</ion-option>
          <ion-option *ngFor="let location of locations" [value]="location.location_name">{{
            location.location_nice_name }}</ion-option>
        </ion-select>
      </ion-item>
      <ion-item>
        <ion-label>Day</ion-label>
        <ion-select [(ngModel)]="tripDay">
          <ion-option value="mon-fri">Monday-Friday</ion-option>
          <ion-option value="sat">Saturday</ion-option>
          <ion-option value="sun">Sunday</ion-option>
        </ion-select>
      </ion-item>
      <ion-item>
        <ion-label>Upcoming Trips Only</ion-label>
        <ion-select [(ngModel)]="comingTripsOnly">
          <ion-option value="">False</ion-option>
          <ion-option value="true">True</ion-option>
        </ion-select>
      </ion-item>
      <ion-item>
        <button ion-button outline small class="notification-button colored-border" (click)="filterTrips(fromLocation, toLocation, tripDay, comingTripsOnly)">
          Search
        </button>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<ion-content #content>
  <!-- refresher -->
  <ion-refresher pullMax="400" pullMin="60" (ionRefresh)="getTrips($event)">
    <ion-refresher-content pullingIcon="refresh"> </ion-refresher-content>
  </ion-refresher>

  <ng-template let-trips [ngIf]="filteredTrip$ | async" [ngIfElse]="loadingTrips">
    <div class="row mt-3" *ngIf="numberOfTrips!=0">
      <div class="col-12">
        <div *ngFor="let sourceKey of objectKeys(trips)">
          <div class="px-0 trips-card" *ngFor="let destinationKey of objectKeys(trips[sourceKey])">
            <h2 class=" trips-card-header py-4 px-3 mb-3 sticky-top" [ngStyle]="{
                background:
                  'linear-gradient(to right, ' +
                  getLocationColor(sourceKey) +
                  ',' +
                  getLocationColor(destinationKey) +
                  ')'
              }">
              {{
              getLocationDisplayName(sourceKey) +
              " -> " +
              getLocationDisplayName(destinationKey)
              }}
              <span *ngIf="sourceKey == 'mosque' || destinationKey == 'mosque'">(Friday only)</span>
            </h2>
            <div class="row trips-card-data">
              <p *ngFor="let trip of trips[sourceKey][destinationKey]"
                class="col-3 text-center trip-time"
                [class.coming] ="strToDate(trip.trip_time) >= dateNow"
              >
                {{ trip.trip_time }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row d-flex justify-content-center" *ngIf="numberOfTrips==0">
      <div class="col-6">
        <h4 style="color: white">
          There is no more trips from {{fromLocation}} to {{toLocation}} on {{tripDay}}
        </h4>
      </div>
    </div>
  </ng-template>
  <ng-template #loadingTrips>
    <ion-card *ngFor="let i of numOfSkeletons">
      <ion-card-content>
        <skeleton-item height="20px" width="80%"></skeleton-item>
        <skeleton-item height="16px" width="40%"></skeleton-item>
      </ion-card-content>
    </ion-card>
  </ng-template>
</ion-content>